<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Årbol de Decisi√≥n - Juego del Nim</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .slider {
            width: 200px;
            margin: 10px 0;
        }
        
        .tree-container {
            display: flex;
            justify-content: center;
            overflow-x: auto;
            padding: 20px 0;
        }
        
        .tree {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .level {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .node {
            min-width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: 3px solid #333;
        }
        
        .node:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .winning {
            background-color: #4CAF50;
            color: white;
        }
        
        .losing {
            background-color: #f44336;
            color: white;
        }
        
        .connection {
            width: 2px;
            height: 40px;
            background-color: #666;
            margin: 0 auto;
        }
        
        .move-label {
            background: #2196F3;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            position: absolute;
            top: -10px;
            right: -10px;
        }
        
        .explanation {
            margin-top: 30px;
            padding: 20px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .code-section {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .level {
                gap: 10px;
            }
            .node {
                min-width: 45px;
                height: 45px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>√Årbol de Decisi√≥n Recursivo - Juego del Nim</h1>
            <p>Explora c√≥mo la recursividad determina las posiciones ganadoras</p>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="initialObjects">Objetos iniciales: <span id="objectCount">7</span></label>
                <input type="range" id="initialObjects" class="slider" min="1" max="12" value="7">
            </div>
            <div class="control-group">
                <button id="expandAll">Expandir Todo</button>
                <button id="collapseAll">Contraer Todo</button>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color winning"></div>
                <span>Posici√≥n Ganadora</span>
            </div>
            <div class="legend-item">
                <div class="legend-color losing"></div>
                <span>Posici√≥n Perdedora</span>
            </div>
        </div>
        
        <div class="tree-container">
            <div id="decisionTree" class="tree"></div>
        </div>
        
        <div class="explanation">
            <h3>Concepto de Recursividad en el Nim</h3>
            <p id="nodeExplanation">Selecciona un nodo para ver c√≥mo se eval√∫a recursivamente.</p>
            <div class="code-section">
                <h4>Pseudoc√≥digo de la funci√≥n recursiva:</h4>
                <pre id="pseudocode">
funci√≥n esGanadora(n):
    si n == 0:
        retornar falso  // Caso base: sin objetos, pierdes
    
    para k de 1 a min(3, n):
        si NO esGanadora(n - k):  // Llamada recursiva
            retornar verdadero    // Encontr√≥ un movimiento ganador
    
    retornar falso  // Todos los movimientos son perdedores
                </pre>
            </div>
        </div>
    </div>

    <script>
        // Funci√≥n recursiva para determinar si una posici√≥n es ganadora
        function isWinning(n, memo = {}) {
            if (n in memo) return memo[n];
            
            if (n === 0) {
                memo[n] = false;
                return false;
            }
            
            for (let k = 1; k <= Math.min(3, n); k++) {
                if (!isWinning(n - k, memo)) {
                    memo[n] = true;
                    return true;
                }
            }
            
            memo[n] = false;
            return false;
        }
        
        // Generar el √°rbol de decisi√≥n
        function generateTree(initialN, maxDepth = 4) {
            const tree = document.getElementById('decisionTree');
            tree.innerHTML = '';
            
            const levels = [];
            const visited = new Set();
            
            function buildLevel(nodes, depth) {
                if (depth > maxDepth || nodes.length === 0) return;
                
                const levelDiv = document.createElement('div');
                levelDiv.className = 'level';
                
                const nextNodes = [];
                
                nodes.forEach(nodeData => {
                    const { value, parentPath } = nodeData;
                    
                    if (visited.has(value) && depth > 1) return;
                    visited.add(value);
                    
                    const nodeDiv = document.createElement('div');
                    nodeDiv.className = `node ${isWinning(value) ? 'winning' : 'losing'}`;
                    nodeDiv.textContent = value;
                    nodeDiv.setAttribute('data-value', value);
                    nodeDiv.setAttribute('data-depth', depth);
                    
                    nodeDiv.addEventListener('click', () => explainNode(value));
                    
                    levelDiv.appendChild(nodeDiv);
                    
                    // Agregar conexiones y nodos hijos
                    if (depth < maxDepth && value > 0) {
                        for (let k = 1; k <= Math.min(3, value); k++) {
                            const childValue = value - k;
                            if (childValue >= 0) {
                                nextNodes.push({ 
                                    value: childValue, 
                                    parentPath: parentPath + ' ‚Üí ' + childValue,
                                    move: k
                                });
                            }
                        }
                    }
                });
                
                tree.appendChild(levelDiv);
                
                if (nextNodes.length > 0 && depth < maxDepth) {
                    const connectionDiv = document.createElement('div');
                    connectionDiv.innerHTML = nextNodes.map(node => 
                        `<div class="connection" style="display: inline-block; margin: 0 20px;">
                            <div class="move-label">-${node.move}</div>
                        </div>`
                    ).join('');
                    tree.appendChild(connectionDiv);
                    
                    buildLevel(nextNodes, depth + 1);
                }
            }
            
            buildLevel([{ value: initialN, parentPath: `${initialN}`, move: 0 }], 0);
        }
        
        // Explicar un nodo espec√≠fico
        function explainNode(n) {
            const explanation = document.getElementById('nodeExplanation');
            const isWin = isWinning(n);
            
            let text = `<strong>Evaluando posici√≥n con ${n} objetos:</strong><br><br>`;
            
            if (n === 0) {
                text += "üî¥ <strong>Caso base:</strong> No hay objetos. El jugador actual pierde.";
            } else if (isWin) {
                text += "üü¢ <strong>Posici√≥n ganadora:</strong><br>";
                text += `El jugador puede ganar porque existe al menos un movimiento que deja al oponente en posici√≥n perdedora:<br>`;
                
                for (let k = 1; k <= Math.min(3, n); k++) {
                    const childWins = isWinning(n - k);
                    if (!childWins) {
                        text += `‚Ä¢ Retirar ${k} objetos ‚Üí quedan ${n - k} (posici√≥n perdedora) ‚úì<br>`;
                    } else {
                        text += `‚Ä¢ Retirar ${k} objetos ‚Üí quedan ${n - k} (posici√≥n ganadora) ‚úó<br>`;
                    }
                }
            } else {
                text += "üî¥ <strong>Posici√≥n perdedora:</strong><br>";
                text += `Todos los movimientos posibles dejan al oponente en posici√≥n ganadora:<br>`;
                
                for (let k = 1; k <= Math.min(3, n); k++) {
                    const remaining = n - k;
                    if (remaining >= 0) {
                        text += `‚Ä¢ Retirar ${k} objetos ‚Üí quedan ${remaining} (posici√≥n ganadora) ‚úó<br>`;
                    }
                }
            }
            
            text += `<br><strong>Patr√≥n:</strong> Las posiciones perdedoras son m√∫ltiplos de 4: 0, 4, 8, 12, 16...`;
            
            explanation.innerHTML = text;
        }
        
        // Event listeners
        document.getElementById('initialObjects').addEventListener('input', (e) => {
            const value = e.target.value;
            document.getElementById('objectCount').textContent = value;
            generateTree(parseInt(value));
        });
        
        document.getElementById('expandAll').addEventListener('click', () => {
            const nodes = document.querySelectorAll('.node');
            nodes.forEach(node => node.style.display = 'flex');
        });
        
        document.getElementById('collapseAll').addEventListener('click', () => {
            const nodes = document.querySelectorAll('.node[data-depth]');
            nodes.forEach(node => {
                if (parseInt(node.getAttribute('data-depth')) > 2) {
                    node.style.display = 'none';
                }
            });
        });
        
        // Inicializar el √°rbol
        generateTree(7);
        explainNode(7);
    </script>
</body>
</html>
