

hemos creado un bot de telegram de analisis de sentimiento de una accion o etf, se ejecuta al escribir /analysis "stock" desde el bot de @stock_market_analytics_bot el cual esta abierto a todo el mundo. El bot lo que hace es pasar el nombre del stock del que queremos saber como esta el mercado mediante un trigger de telegram al inicio del flujo de n8n, cuando tenemos el mensaje lo que hacemos es descartar todos los mensajes que no contengan la palabra /analysis, cuando tengamos el json del mensaje lo pasamos mediante un bloque de codigo de javascript que lo que hace ser치 devolvernos unicamente el texto que viene a continuacion de /analysis lo cual es lo unico que queremos del mensaje, de esta forma quitamos, el nombre de usuario y todos los dem치s campos que no nos interesan. Cuando tenemos este unico json con el nombre "texto":"stock" y el "id":id lo que hacemos es pasarlo a un modelo de busqueda inteligente, usando un nodo de http request y una api key de perplexity mandamos un post a https://api.perplexity.ai/search que nos devolvera las 8 notocias de un maximo de 2048 tokens por nooticia buscando lo siguiente: Last news about the stock of {{ $json.text }}, estas 8 noticias se las pasamos a nuestro agente LLM que hara uso de estas noticias para devolvernos un texto el cual nos comentar치 el sentimiento del mercado y que accion a medio plazo entre las siguientes nos recomienda y porque: compra fuerte, compra, holdear, vender o venta fuerte. Cuando acabe de ejecutarse el modelo el texto final se devolvera al usuario mediante un nodo de send mensaje de telegram que usar치 el id del usuario que hemos recogido antes para mandarle el texto que proporcione el agente. Para poder crear el trigger de telegram tuvimos que abrir el servidor local a internet, esto lo hicimos usando un tunnel de cloudflared. Tenemos un .sh que lo que hace es lanzar el tunnel desde el puerto localhost:5678 a una url que no es estatica por lo que cuando se crear el tunnel el .sh lee la url que nos proporcione cloudflared y la copia en las variables de entorno .env local, cuando las tiene copiadas lanza el contenedor usando estas variables de entorno para que el trigger de telegram funcione correctamente sin preocuparnos de estar cambiando la url cada vez que reiniciamos, de forma que tenemos un comando para iniciarlo todo directamente. 